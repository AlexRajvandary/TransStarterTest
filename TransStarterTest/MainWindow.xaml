<Window x:Class="TransStarterTest.MainWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
        xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
        xmlns:local="clr-namespace:TransStarterTest"
        xmlns:enum="clr-namespace:TransStarterTest.Models.Enums"
        xmlns:sys="clr-namespace:System;assembly=mscorlib"
        mc:Ignorable="d"
        Title="MainWindow" Height="500" Width="900">
    <Window.Resources>
        <!-- Значения для ComboBox-ов режима и настроект группировки/аггрегирования -->
        <ObjectDataProvider MethodName="GetValues" 
                            ObjectType="{x:Type sys:Enum}" 
                            x:Key="ReportViewModeValues">
            <ObjectDataProvider.MethodParameters>
                <x:Type TypeName="enum:ReportViewMode"/>
            </ObjectDataProvider.MethodParameters>
        </ObjectDataProvider>

        <ObjectDataProvider MethodName="GetValues" 
                     ObjectType="{x:Type sys:Enum}" 
                     x:Key="GroupingOptionsValues">
            <ObjectDataProvider.MethodParameters>
                <x:Type TypeName="enum:GroupingOptions"/>
            </ObjectDataProvider.MethodParameters>
        </ObjectDataProvider>

        <ObjectDataProvider MethodName="GetValues" 
              ObjectType="{x:Type sys:Enum}" 
              x:Key="AggregateOptionsValues">
            <ObjectDataProvider.MethodParameters>
                <x:Type TypeName="enum:AggregateOptions"/>
            </ObjectDataProvider.MethodParameters>
        </ObjectDataProvider>
    </Window.Resources>

    <Grid Margin="10">
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
            <RowDefinition Height="Auto"/>
        </Grid.RowDefinitions>

        <TextBlock Text="Car Sales Dashboard" 
                   FontSize="24" 
                   FontWeight="Bold" 
                   HorizontalAlignment="Center" 
                   Margin="0,0,0,10"/>

        <TabControl Grid.Row="1" 
                    ItemsSource="{Binding Tabs}" 
                    SelectedItem="{Binding SelectedTab}">
            <TabControl.ItemTemplate>
                <DataTemplate>
                    <TextBlock Text="{Binding Title}" />
                </DataTemplate>
            </TabControl.ItemTemplate>

            <TabControl.ContentTemplate>
                <DataTemplate>
                    <Grid>
                        <Grid.RowDefinitions>
                            <RowDefinition Height="Auto"/>
                            <RowDefinition Height="*"/>
                        </Grid.RowDefinitions>

                        <!-- Панель фильтров -->
                        <StackPanel Orientation="Horizontal" Margin="0,0,0,10">
                            <TextBlock Text="Режим:" VerticalAlignment="Center" Margin="0,0,5,0"/>
                            <ComboBox Width="120"
                                      ItemsSource="{Binding Source={StaticResource ReportViewModeValues}}"
                                      SelectedItem="{Binding ViewMode}"/>

                            <!-- Параметры только для Pivot -->
                            <StackPanel Orientation="Horizontal" Margin="10,0,0,0">
                                <StackPanel.Style>
                                    <Style TargetType="StackPanel">
                                        <Setter Property="Visibility" Value="Collapsed"/>
                                        <Style.Triggers>
                                            <DataTrigger Binding="{Binding ViewMode}" Value="Pivot">
                                                <Setter Property="Visibility" Value="Visible"/>
                                            </DataTrigger>
                                        </Style.Triggers>
                                    </Style>
                                </StackPanel.Style>

                                <TextBlock Text="Группировка:" VerticalAlignment="Center" Margin="0,0,5,0"/>
                                <ComboBox Width="120"
                                           ItemsSource="{Binding Source={StaticResource GroupingOptionsValues}}"
                                          SelectedItem="{Binding ReportSettings.GroupBy}"/>

                                <TextBlock Text="Агрегат:" VerticalAlignment="Center" Margin="10,0,5,0"/>
                                <ComboBox Width="120"
                                          ItemsSource="{Binding Source={StaticResource AggregateOptionsValues}}"
                                          SelectedItem="{Binding ReportSettings.AggregateBy}"/>

                                <TextBlock Text="Год:" VerticalAlignment="Center" Margin="10,0,5,0"/>
                                <ComboBox Width="100"
                                          ItemsSource="{Binding DataContext.AvailableYears, RelativeSource={RelativeSource AncestorType=Window}}"
                                          SelectedItem="{Binding ReportSettings.YearFilter}"/>
                            </StackPanel>

                            <Button Content="Refresh" Command="{Binding RefreshCommand}" Margin="10,0,0,0"/>
                        </StackPanel>

                        <!-- Обычный режим -->
                        <DataGrid Grid.Row="1"
                                  ItemsSource="{Binding ReportData}"
                                  AutoGenerateColumns="False">
                            <DataGrid.Style>
                                <Style TargetType="DataGrid">
                                    <Setter Property="Visibility" Value="Collapsed"/>
                                    <Style.Triggers>
                                        <DataTrigger Binding="{Binding ViewMode}" Value="Details">
                                            <Setter Property="Visibility" Value="Visible"/>
                                        </DataTrigger>
                                    </Style.Triggers>
                                </Style>
                            </DataGrid.Style>

                            <DataGrid.Columns>
                                <DataGridTextColumn Header="Дата" Binding="{Binding Date, StringFormat=dd/MM/yyyy}"/>
                                <DataGridTextColumn Header="Покупатель" Binding="{Binding CustomerFullName}"/>
                                <DataGridTextColumn Header="Бренд" Binding="{Binding BrandName}"/>
                                <DataGridTextColumn Header="Модель" Binding="{Binding ModelName}"/>
                                <DataGridTextColumn Header="Цена" Binding="{Binding Price}"/>
                            </DataGrid.Columns>
                        </DataGrid>

                        <!-- Pivot режим -->
                        <DataGrid Grid.Row="1"
                                  ItemsSource="{Binding Pivot.Rows}"
                                  AutoGenerateColumns="False">
                            <DataGrid.Style>
                                <Style TargetType="DataGrid">
                                    <Setter Property="Visibility" Value="Collapsed"/>
                                    <Style.Triggers>
                                        <DataTrigger Binding="{Binding ViewMode}" Value="Pivot">
                                            <Setter Property="Visibility" Value="Visible"/>
                                        </DataTrigger>
                                    </Style.Triggers>
                                </Style>
                            </DataGrid.Style>

                            <DataGrid.Columns>
                                <DataGridTextColumn Header="Группа" Binding="{Binding RowKey}"/>
                                <!-- Пример: статично для месяцев -->
                                <DataGridTextColumn Header="Январь" Binding="{Binding Cells[1]}"/>
                                <DataGridTextColumn Header="Февраль" Binding="{Binding Cells[2]}"/>
                                <!-- остальные месяцы по аналогии -->
                            </DataGrid.Columns>
                        </DataGrid>
                    </Grid>
                </DataTemplate>
            </TabControl.ContentTemplate>
        </TabControl>

        <StackPanel Grid.Row="2" Orientation="Horizontal" HorizontalAlignment="Right" Margin="0,10,0,0">
            <Button Content="Добавить отчет" Width="150" Height="30" Margin="0,0,10,0" Command="{Binding AddTabCommand}"/>
            <Button Content="Export to Excel" Width="150" Height="30" Command="{Binding ExportCommand}"/>
        </StackPanel>
    </Grid>
</Window>
